<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="pageTitle">Laboratorio 3D - MonteVer3D</title>
    <meta name="description" content="Herramientas avanzadas de an√°lisis 3D">
    <link rel="icon" type="image/png" href="images/favicon.png">
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/model-base.css">
    <link rel="stylesheet" href="css/model-viewer-lab.css">
    
    <!-- Three.js r84 + Loaders -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/84/three.min.js"></script>
    <script src="https://cdn.rawgit.com/mrdoob/three.js/r84/examples/js/loaders/STLLoader.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/mrdoob/three.js@r84/examples/js/loaders/OBJLoader.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/mrdoob/three.js@r84/examples/js/loaders/MTLLoader.js"></script>
    <script src="https://cdn.rawgit.com/mrdoob/three.js/r84/examples/js/controls/OrbitControls.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/gif.js@0.2.0/dist/gif.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
    <!-- HEADER & NAVIGATION -->
    <header>
        <nav>
            <div class="logo-container">
                <img src="images/logo/logo-monteverde.png" alt="MonteVer3D Logo" class="logo-monteverde">
                <img src="images/logo/logo-uach.png" alt="Universidad Austral de Chile" class="logo-uach">
            </div>
            <ul class="nav-links" id="navLinks">
                <li><a href="index.html">INICIO</a></li>
                <li><a href="catalog.html">CAT√ÅLOGO</a></li>
                <li><a href="casos.html">CASOS DE USO</a></li>
                <li><a href="index.html#como-funciona">C√ìMO FUNCIONA</a></li>
                <li><a href="about.html">ACERCA DE</a></li>
                <li><a href="index.html#cta-section">CONTRIBUIR</a></li>
                <li><a href="index.html#cta-section">CONTACTO</a></li>
            </ul>
            
            <button class="menu-toggle" id="menuToggle" aria-label="Toggle menu">
                <span></span>
                <span></span>
                <span></span>
            </button>
        </nav>
    </header>
    
    <!-- Admin Link -->
    <a href="admin/index.html" class="admin-link" title="Panel de Administraci√≥n">üîí</a>

    <!-- BREADCRUMB -->
    <section class="breadcrumb-section">
        <div class="container">
            <div class="breadcrumb">
                <a href="index.html">Inicio</a>
                <span>‚Ä∫</span>
                <a href="catalog.html">Cat√°logo</a>
                <span>‚Ä∫</span>
                <span id="breadcrumbCategory">Categor√≠a</span>
                <span>‚Ä∫</span>
                <span>üî¨ Laboratorio 3D</span>
                <span>‚Ä∫</span>
                <span id="breadcrumbTitle">Modelo 3D</span>
            </div>
        </div>
    </section>

    <!-- 3D VIEWER HERO SECTION -->
    <section class="viewer-hero-section" id="viewerSection" style="display: none;">
        <div class="container">
            <div class="viewer-hero-container">
                <!-- Enhanced Floating Controls - Max 2 columns -->
                <div class="viewer-floating-controls">
                    <!-- Toast Notification -->
                    <div id="viewerToast" class="viewer-toast"></div>
                    <!-- LEFT CONTROLS -->
                    <div class="controls-left">
                        <div class="control-group control-group-horizontal">
                            <button class="viewer-control-btn" id="toggleControlsBtn" onclick="toggleControlsVisibility()" title="Mostrar/Ocultar controles">
                                üëÅÔ∏è
                            </button>
                            <button class="viewer-reset-btn" onclick="resetAndScroll()" title="Resetear vista">
                                üîÑ
                            </button>
                            <button class="viewer-control-btn" onclick="toggleViewerFullscreen()" title="Pantalla completa">
                                üñ•Ô∏è
                            </button>
                        </div>
                    </div>
                    
                    <!-- RIGHT CONTROLS -->
                    <div class="controls-right">
                        <!-- Camera & View Group (2x2 grid) -->
                        <div class="control-group control-group-grid">
                            <button class="viewer-control-btn" onclick="cycleCameraView()" title="Cambiar vista">
                                üé•
                            </button>
                            <button class="viewer-control-btn" id="cameraRotateBtn" onclick="toggleCameraRotation()" title="Auto-rotaci√≥n c√°mara">
                                üé¨
                            </button>
                        </div>
                        
                        <!-- Material & Background Group (2x2 grid) -->
                        <div class="control-group control-group-grid">
                            <button class="viewer-control-btn" onclick="toggleMaterialMode()" title="Cambiar modo de material">
                                üé®
                            </button>
                            <input type="color" id="bgColorPicker" value="#2F5233" onchange="setSceneColor(this.value)" 
                                class="viewer-control-btn color-picker-btn" title="Color de fondo">
                            <button class="viewer-control-btn" id="groundBtn" onclick="toggleGround()" title="Toggle Bandeja">
                                üèûÔ∏è
                            </button>
                            <button class="viewer-control-btn" id="gridBtn" onclick="toggleGrid()" title="Toggle Grid">
                                üìè
                            </button>
                        </div>
                        
                        <!-- Advanced Tools (2x2 grid) -->
                        <div class="control-group control-group-grid">
                            <button class="viewer-control-btn" onclick="toggleRepositionPanel()" title="Rotaci√≥n del Modelo">
                                üåÄ
                            </button>
                            <button class="viewer-control-btn" onclick="toggleMeasurementPanel()" title="Herramientas de Medici√≥n">
                                üìê
                            </button>
                            <button class="viewer-control-btn" onclick="toggleNotesPanel()" title="Notas del Reporte">
                                üìù
                            </button>
                            <button class="viewer-control-btn" onclick="alert('Pr√≥ximamente')" title="Pr√≥xima herramienta" style="opacity: 0.5;">
                                ‚ùì
                            </button>
                        </div>
                    </div>
                    
                    <!-- Export Menu -->
                    <div class="export-menu" id="exportMenu">
                        <div class="export-menu-header">
                            üì§ Exportar
                            <button onclick="toggleExportMenu()" style="background: none; border: none; color: #999; font-size: 1.2rem; cursor: pointer; padding: 0; margin-left: auto; line-height: 1;" onmouseover="this.style.color='#E63946'" onmouseout="this.style.color='#999'">‚úï</button>
                        </div>
                        <button class="export-menu-item" onclick="exportScreenshotDefault()">
                            üì∏ Screenshot
                        </button>
                        <div class="export-menu-divider"></div>
                        <button class="export-menu-item" id="gifRecordBtn" onclick="toggleGIFRecording()">
                            üéûÔ∏è Grabar GIF
                        </button>
                        <button class="export-menu-item" id="videoRecordBtn" onclick="toggleVideoRecordingDefault()">
                            üé• Grabar Video
                        </button>
                        <div class="export-menu-divider"></div>
                        <button class="export-menu-item" onclick="openExportSettings()">
                            ‚öôÔ∏è Configuraci√≥n
                        </button>                      
                    </div> 
                </div>
                
                <div class="rotation-advanced-panel" id="repositionPanel">
                    <div class="rotation-panel-header">
                        <span>üåÄ Rotaci√≥n del Modelo</span>
                        <button onclick="toggleRepositionPanel()" class="panel-close-btn">√ó</button>
                    </div>
                    
                    <div class="rotation-panel-content">
                        <div class="rotation-option">
                            <label>Girar Modelo:</label>
                            <button id="modelRotateToggle" class="rotation-mode-btn" onclick="toggleModelRotation()"
                                    style="width: 100%;">
                                üåÄ Activar Rotaci√≥n
                            </button>
                        </div>
                        
                        <div class="rotation-option" style="opacity: 0.5;">
                            <label>Velocidad: <span id="speedValue">0.01</span></label>
                            <input type="range" id="speedSlider" min="0.005" max="0.05" step="0.005" value="0.01" 
                                oninput="updateRotationSpeed(this.value)" class="rotation-slider">
                        </div>
                        
                        <div class="rotation-option" style="opacity: 0.5;">
                            <label>Eje:</label>
                            <select id="axisSelect" onchange="setRotationAxis(this.value)" class="rotation-select">
                                <option value="x">X (Horizontal)</option>
                                <option value="y" selected>Y (Vertical)</option>
                                <option value="z">Z (Profundidad)</option>
                            </select>
                        </div>
                        
                        <div class="rotation-option">
                            <label>üéØ Rotaci√≥n Manual:</label>
                            <div class="manual-rotation-controls">
                                <div class="rotation-axis-control">
                                    <span class="axis-label">X:</span>
                                    <input type="range" id="rotation-x-slider" min="0" max="360" value="0" 
                                        oninput="updateRotationInput('x', this.value)" class="rotation-slider-small">
                                    <input type="number" id="rotation-x-value" min="0" max="360" value="0" 
                                        oninput="setManualRotation('x', this.value); document.getElementById('rotation-x-slider').value = this.value"
                                        class="rotation-number-input">
                                </div>
                                <div class="rotation-axis-control">
                                    <span class="axis-label">Y:</span>
                                    <input type="range" id="rotation-y-slider" min="0" max="360" value="0" 
                                        oninput="updateRotationInput('y', this.value)" class="rotation-slider-small">
                                    <input type="number" id="rotation-y-value" min="0" max="360" value="0" 
                                        oninput="setManualRotation('y', this.value); document.getElementById('rotation-y-slider').value = this.value"
                                        class="rotation-number-input">
                                </div>
                                <div class="rotation-axis-control">
                                    <span class="axis-label">Z:</span>
                                    <input type="range" id="rotation-z-slider" min="0" max="360" value="0" 
                                        oninput="updateRotationInput('z', this.value)" class="rotation-slider-small">
                                    <input type="number" id="rotation-z-value" min="0" max="360" value="0" 
                                        oninput="setManualRotation('z', this.value); document.getElementById('rotation-z-slider').value = this.value"
                                        class="rotation-number-input">
                                </div>
                                <button onclick="resetManualRotation()" class="rotation-axis-reset-btn">‚Ü∫ Reset Rotaci√≥n</button>
                            </div>
                        </div>
                        
                        <button onclick="resetRotationSettings()" class="rotation-reset-btn">üîÑ Restaurar Todo</button>
                    </div>
                </div> 
                <!-- MEASUREMENT TOOLS PANEL -->
                <div class="rotation-advanced-panel" id="measurementPanel">
                    <div class="rotation-panel-header">
                        <span>üìè Herramientas de Medici√≥n</span>
                        <button onclick="toggleMeasurementPanel()" class="panel-close-btn">√ó</button>
                    </div>
                    
                    <div class="rotation-panel-content" style="max-height: 500px; overflow-y: auto;">
                        <div class="rotation-option">
                            <label>Unidades:</label>
                            <select id="unitSelect" onchange="changeMeasurementUnit(this.value)" class="rotation-select">
                                <option value="mm" selected>Mil√≠metros (mm)</option>
                                <option value="cm">Cent√≠metros (cm)</option>
                                <option value="m">Metros (m)</option>
                            </select>
                        </div>
                        
                        <!-- Dimension Display -->
                        <div class="rotation-option" style="border-bottom: 2px solid var(--color-light-gray); padding-bottom: 0.75rem; margin-bottom: 0.75rem;">
                            <button id="dimensionsToggle" onclick="toggleDimensions()" class="rotation-mode-btn" style="width: 100%;">
                                üì¶ Mostrar Dimensiones
                            </button>
                        </div>
                        
                        <!-- Distance Measurement Tool -->
                        <div class="rotation-option">
                            <label style="font-weight: 600;">üìè Medir entre Puntos</label>
                            <button id="distanceMeasureToggle" onclick="toggleDistanceMeasurement()" class="rotation-mode-btn" style="width: 100%; margin-top: 0.5rem;">
                                üìè Activar Medici√≥n
                            </button>
                            <button id="clearDistanceBtn" onclick="clearDistanceMeasurement()" class="rotation-axis-reset-btn" style="width: 100%; margin-top: 0.5rem; opacity: 0.5;" disabled>
                                üóëÔ∏è Borrar Medici√≥n
                            </button>
                            <div class="rotation-option" id="measurementListContainer" style="display: none; margin-top: 1rem;">
                                <label style="font-weight: 600; margin-bottom: 0.5rem; display: block;">üìã Mediciones Activas</label>
                                <div id="measurementList" style="max-height: 200px; overflow-y: auto; display: flex; flex-direction: column; gap: 0.5rem;">
                                    <!-- Measurements will be added here dynamically -->
                                </div>
                            </div>                            
                            <div id="distanceInfo" style="margin-top: 0.5rem; padding: 0.5rem; background: rgba(212, 164, 53, 0.1); border-radius: 5px; font-size: 0.85rem; color: var(--color-secondary); text-align: center; display: none;">
                                Click en el modelo para marcar puntos
                            </div>
                        </div>
                        <!-- SCREENSHOT GALLERY -->
                        <div class="rotation-option" id="screenshotGalleryContainer" style="margin-top: 1rem; border-top: 2px solid var(--color-light-gray); padding-top: 1rem;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                                <label style="font-weight: 600;">üì∏ Galer√≠a de Screenshots</label>
                                <button onclick="clearScreenshotGallery()" style="background: none; border: none; color: #E63946; cursor: pointer; font-size: 0.85rem; font-weight: 600;">Limpiar</button>
                            </div>
                            <div id="screenshotGalleryList" style="display: flex; flex-direction: column; gap: 0.5rem; margin-bottom: 0.5rem;">
                                <!-- Screenshots will be added here -->
                            </div>
                            <button onclick="captureScreenshotForGallery()" class="rotation-mode-btn" style="width: 100%;">
                                üì∏ Capturar Vista Actual
                            </button>
                        </div>
                    </div>
                </div>   
                <!-- NOTES PANEL -->
                <div class="rotation-advanced-panel" id="notesPanel">
                    <div class="rotation-panel-header">
                        <span>üìù Notas del Reporte</span>
                        <button onclick="toggleNotesPanel()" class="panel-close-btn">√ó</button>
                    </div>
                    
                    <div class="rotation-panel-content" style="max-height: 500px; overflow-y: auto;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.75rem;">
                            <p style="margin: 0; font-size: 0.85rem; color: #666;">A√±ade notas sobre el modelo</p>
                            <button onclick="clearAllNotes()" style="background: none; border: none; color: #E63946; cursor: pointer; font-size: 0.85rem; font-weight: 600;">Limpiar</button>
                        </div>
                        
                        <div id="notesListContainer" style="display: flex; flex-direction: column; gap: 0.75rem; margin-bottom: 0.75rem;">
                            <div style="padding: 1rem; text-align: center; color: #999; font-size: 0.85rem;">No hay notas guardadas</div>
                        </div>
                        
                        <button onclick="addReportNote()" class="rotation-mode-btn" style="width: 100%;">
                            ‚ûï A√±adir Nota
                        </button>
                    </div>
                </div>                    
                <!-- Three.js canvas -->
                <div id="modelViewer" class="model-viewer-canvas">
                    <div class="viewer-loading">
                        <div class="loader"></div>
                        <p>Cargando modelo 3D...</p>
                    </div>
                </div>
                
                <!-- CONSOLE BAR -->
                <div class="viewer-console-bar">
                    <div class="console-info">
                        <span id="consoleStatus">üî¨ Laboratorio 3D activo</span>
                    </div>
                    <div class="console-actions">
                        <button class="console-btn console-btn-export" onclick="toggleExportMenu()" title="Exportar">
                            üì∑ Exportar
                        </button>
                        <button class="console-btn console-btn-report" onclick="openPDFReportModal()" title="Generar Reporte PDF">
                            üìÑ Reporte PDF
                        </button>
                    </div>
                </div>

                <div class="rotation-hint active" id="rotationHint">
                    <button class="rotation-hint-close" onclick="closeRotationHint()">√ó</button>
                    <span class="rotation-hint-icon">üîÑ</span>
                    <p>Rota tu dispositivo a horizontal para mejor visualizaci√≥n</p>
                </div>
            </div>
        </div>
                <!-- EXPORT SETTINGS MODAL -->
                <div id="exportSettingsModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 10001; align-items: center; justify-content: center;">
                    <div style="background: white; border-radius: 15px; max-width: 500px; width: 90%; max-height: 90vh; overflow-y: auto; box-shadow: 0 8px 32px rgba(0,0,0,0.3);">
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 1.5rem; border-bottom: 2px solid var(--color-light-gray);">
                            <h3 style="margin: 0; color: var(--color-secondary); font-size: 1.5rem;">‚öôÔ∏è Configuraci√≥n de Exportaci√≥n</h3>
                            <button onclick="closeExportSettings()" style="background: none; border: none; font-size: 2rem; cursor: pointer; color: #999; line-height: 1;" onmouseover="this.style.color='#E63946'" onmouseout="this.style.color='#999'">‚úï</button>
                        </div>
                        
                        <div style="padding: 1.5rem; display: flex; flex-direction: column; gap: 2rem;">
                            <!-- GIF SETTINGS -->
                            <div class="settings-section">
                                <h4 style="color: var(--color-secondary); margin-bottom: 1rem; font-size: 1.2rem;">üéûÔ∏è GIF</h4>
                                <div style="display: flex; flex-direction: column; gap: 1rem;">
                                    <div>
                                        <label style="display: block; font-weight: 600; margin-bottom: 0.5rem; color: var(--color-gray);">FPS: <span id="gifFpsValue">10</span></label>
                                        <input type="range" id="gifFpsSlider" min="5" max="30" value="10" oninput="updateSettingValue('gifFps', this.value)" style="width: 100%; cursor: pointer;">
                                        <div style="display: flex; justify-content: space-between; font-size: 0.8rem; color: #999; margin-top: 0.25rem;">
                                            <span>5 fps</span>
                                            <span>30 fps</span>
                                        </div>
                                    </div>
                                    <div>
                                        <label style="display: block; font-weight: 600; margin-bottom: 0.5rem; color: var(--color-gray);">Duraci√≥n: <span id="gifDurationValue">6</span>s</label>
                                        <input type="range" id="gifDurationSlider" min="3" max="15" value="6" oninput="updateSettingValue('gifDuration', this.value)" style="width: 100%; cursor: pointer;">
                                        <div style="display: flex; justify-content: space-between; font-size: 0.8rem; color: #999; margin-top: 0.25rem;">
                                            <span>3s</span>
                                            <span>15s</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- VIDEO SETTINGS -->
                            <div class="settings-section">
                                <h4 style="color: var(--color-secondary); margin-bottom: 1rem; font-size: 1.2rem;">üé• Video</h4>
                                <div style="display: flex; flex-direction: column; gap: 1rem;">
                                    <div>
                                        <label style="display: block; font-weight: 600; margin-bottom: 0.5rem; color: var(--color-gray);">Resoluci√≥n</label>
                                        <select id="videoResolution" onchange="updateSettingValue('videoResolution', this.value)" style="width: 100%; padding: 0.6rem; border: 2px solid var(--color-light-gray); border-radius: 8px; font-size: 0.9rem; cursor: pointer;">
                                            <option value="720">720p (1280x720)</option>
                                            <option value="1080">1080p (1920x1080)</option>
                                            <option value="1440">1440p (2560x1440)</option>
                                        </select>
                                    </div>    
                                    <div>
                                        <label style="display: block; font-weight: 600; margin-bottom: 0.5rem; color: var(--color-gray);">Formato</label>
                                        <select id="videoFormat" onchange="updateSettingValue('videoFormat', this.value)" style="width: 100%; padding: 0.6rem; border: 2px solid var(--color-light-gray); border-radius: 8px; font-size: 0.9rem; cursor: pointer;">
                                            <option value="mp4" selected>MP4 (H.264)</option>
                                            <option value="webm">WebM (VP9)</option>
                                        </select>
                                    </div>                                        
                                    
                                    <div>
                                        <label style="display: block; font-weight: 600; margin-bottom: 0.5rem; color: var(--color-gray);">Duraci√≥n: <span id="videoDurationValue">20</span>s</label>
                                        <input type="range" id="videoDurationSlider" min="5" max="60" value="20" oninput="updateSettingValue('videoDuration', this.value)" style="width: 100%; cursor: pointer;">
                                        <div style="display: flex; justify-content: space-between; font-size: 0.8rem; color: #999; margin-top: 0.25rem;">
                                            <span>5s</span>
                                            <span>60s</span>
                                        </div>
                                    </div>
                                    <div>
                                        <label style="display: block; font-weight: 600; margin-bottom: 0.5rem; color: var(--color-gray);">Bitrate: <span id="videoBitrateValue">2.5</span> Mbps</label>
                                        <input type="range" id="videoBitrateSlider" min="1" max="10" step="0.5" value="2.5" oninput="updateSettingValue('videoBitrate', this.value)" style="width: 100%; cursor: pointer;">
                                        <div style="display: flex; justify-content: space-between; font-size: 0.8rem; color: #999; margin-top: 0.25rem;">
                                            <span>1 Mbps</span>
                                            <span>10 Mbps</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- SCREENSHOT SETTINGS -->
                            <div class="settings-section">
                                <h4 style="color: var(--color-secondary); margin-bottom: 1rem; font-size: 1.2rem;">üì∏ Screenshot</h4>
                                <div style="display: flex; flex-direction: column; gap: 1rem;">
                                    <div>
                                        <label style="display: block; font-weight: 600; margin-bottom: 0.5rem; color: var(--color-gray);">Formato</label>
                                        <select id="screenshotFormat" onchange="updateSettingValue('screenshotFormat', this.value)" style="width: 100%; padding: 0.6rem; border: 2px solid var(--color-light-gray); border-radius: 8px; font-size: 0.9rem; cursor: pointer;">
                                            <option value="png" selected>PNG (Sin p√©rdida)</option>
                                            <option value="jpg">JPG (Comprimido)</option>
                                            <option value="webp">WebP (Moderna)</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label style="display: block; font-weight: 600; margin-bottom: 0.5rem; color: var(--color-gray);">Tama√±o</label>
                                        <select id="screenshotScale" onchange="updateSettingValue('screenshotScale', this.value)" style="width: 100%; padding: 0.6rem; border: 2px solid var(--color-light-gray); border-radius: 8px; font-size: 0.9rem; cursor: pointer;">
                                            <option value="1">1x (Tama√±o actual)</option>
                                            <option value="2" selected>2x (Mejor calidad)</option>
                                            <option value="4">4x (M√°xima calidad)</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            
                            <button onclick="closeExportSettings()" style="width: 100%; padding: 0.8rem; background: var(--gradient-primary); border: none; border-radius: 8px; font-weight: 700; font-size: 1rem; cursor: pointer; color: var(--color-secondary); transition: all 0.3s ease;">‚úÖ Guardar Configuraci√≥n</button>
                        </div>
                    </div>
                </div>
                <!-- PDF REPORT MODAL -->
                <div id="pdfReportModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 10001; align-items: center; justify-content: center; overflow-y: auto; padding: 2rem 0;">
                    <div style="background: white; border-radius: 15px; max-width: 600px; width: 90%; box-shadow: 0 8px 32px rgba(0,0,0,0.3); margin: auto;">
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 1.5rem; border-bottom: 2px solid var(--color-light-gray);">
                            <h3 style="margin: 0; color: var(--color-secondary); font-size: 1.5rem;">üìÑ Generar Reporte PDF</h3>
                            <button onclick="closePDFReportModal()" style="background: none; border: none; font-size: 2rem; cursor: pointer; color: #999; line-height: 1;" onmouseover="this.style.color='#E63946'" onmouseout="this.style.color='#999'">‚úï</button>
                        </div>
                        
                        <div style="padding: 1.5rem; max-height: 60vh; overflow-y: auto;">
                            <p style="margin: 0 0 1.5rem 0; color: #666; font-size: 0.95rem;">Selecciona el contenido a incluir en el reporte:</p>
                            
                            <div style="display: flex; flex-direction: column; gap: 1rem;">
                                <!-- Screenshot Actual -->
                                <label style="display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem; background: rgba(245, 200, 66, 0.1); border-radius: 8px; cursor: pointer; border: 2px solid transparent; transition: all 0.3s;" onmouseover="this.style.borderColor='var(--color-primary)'" onmouseout="this.style.borderColor='transparent'">
                                    <input type="checkbox" id="pdfIncludeCurrentScreenshot" checked style="width: 20px; height: 20px; cursor: pointer;">
                                    <div style="flex: 1;">
                                        <div style="font-weight: 600; color: var(--color-secondary);">üì∏ Screenshot Actual</div>
                                        <div style="font-size: 0.85rem; color: #666;">Vista actual del modelo 3D</div>
                                    </div>
                                </label>
                                
                                <!-- Galer√≠a -->
                                <label style="display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem; background: rgba(245, 200, 66, 0.1); border-radius: 8px; cursor: pointer; border: 2px solid transparent; transition: all 0.3s;" onmouseover="this.style.borderColor='var(--color-primary)'" onmouseout="this.style.borderColor='transparent'">
                                    <input type="checkbox" id="pdfIncludeGallery" checked style="width: 20px; height: 20px; cursor: pointer;">
                                    <div style="flex: 1;">
                                        <div style="font-weight: 600; color: var(--color-secondary);">üñºÔ∏è Galer√≠a de Screenshots</div>
                                        <div style="font-size: 0.85rem; color: #666;" id="galleryCountLabel">0 screenshots guardados</div>
                                    </div>
                                </label>
                                
                                <!-- Mediciones -->
                                <label style="display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem; background: rgba(245, 200, 66, 0.1); border-radius: 8px; cursor: pointer; border: 2px solid transparent; transition: all 0.3s;" onmouseover="this.style.borderColor='var(--color-primary)'" onmouseout="this.style.borderColor='transparent'">
                                    <input type="checkbox" id="pdfIncludeMeasurements" checked style="width: 20px; height: 20px; cursor: pointer;">
                                    <div style="flex: 1;">
                                        <div style="font-weight: 600; color: var(--color-secondary);">üìè Mediciones</div>
                                        <div style="font-size: 0.85rem; color: #666;" id="measurementsCountLabel">0 mediciones activas</div>
                                    </div>
                                </label>
                                
                                <!-- Dimensiones -->
                                <label style="display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem; background: rgba(245, 200, 66, 0.1); border-radius: 8px; cursor: pointer; border: 2px solid transparent; transition: all 0.3s;" onmouseover="this.style.borderColor='var(--color-primary)'" onmouseout="this.style.borderColor='transparent'">
                                    <input type="checkbox" id="pdfIncludeDimensions" checked style="width: 20px; height: 20px; cursor: pointer;">
                                    <div style="flex: 1;">
                                        <div style="font-weight: 600; color: var(--color-secondary);">üì¶ Dimensiones del Modelo</div>
                                        <div style="font-size: 0.85rem; color: #666;">Ancho, Alto, Profundidad</div>
                                    </div>
                                </label>
                                
                                <!-- Notas -->
                                <label style="display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem; background: rgba(245, 200, 66, 0.1); border-radius: 8px; cursor: pointer; border: 2px solid transparent; transition: all 0.3s;" onmouseover="this.style.borderColor='var(--color-primary)'" onmouseout="this.style.borderColor='transparent'">
                                    <input type="checkbox" id="pdfIncludeNotes" checked style="width: 20px; height: 20px; cursor: pointer;">
                                    <div style="flex: 1;">
                                        <div style="font-weight: 600; color: var(--color-secondary);">üìù Notas del Reporte</div>
                                        <div style="font-size: 0.85rem; color: #666;" id="notesCountLabel">0 notas guardadas</div>
                                    </div>
                                </label>
                                
                                <!-- Atribuci√≥n -->
                                <label style="display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem; background: rgba(245, 200, 66, 0.1); border-radius: 8px; cursor: pointer; border: 2px solid transparent; transition: all 0.3s;" onmouseover="this.style.borderColor='var(--color-primary)'" onmouseout="this.style.borderColor='transparent'">
                                    <input type="checkbox" id="pdfIncludeAttribution" checked style="width: 20px; height: 20px; cursor: pointer;">
                                    <div style="flex: 1;">
                                        <div style="font-weight: 600; color: var(--color-secondary);">üìú Informaci√≥n de Atribuci√≥n</div>
                                        <div style="font-size: 0.85rem; color: #666;">Creador, licencia, fuente</div>
                                    </div>
                                </label>
                                
                                <!-- Metadatos -->
                                <label style="display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem; background: rgba(245, 200, 66, 0.1); border-radius: 8px; cursor: pointer; border: 2px solid transparent; transition: all 0.3s;" onmouseover="this.style.borderColor='var(--color-primary)'" onmouseout="this.style.borderColor='transparent'">
                                    <input type="checkbox" id="pdfIncludeMetadata" style="width: 20px; height: 20px; cursor: pointer;">
                                    <div style="flex: 1;">
                                        <div style="font-weight: 600; color: var(--color-secondary);">üìñ Metadatos Completos</div>
                                        <div style="font-size: 0.85rem; color: #666;">Tags, descripci√≥n, origen</div>
                                    </div>
                                </label>
                            </div>
                        </div>
                        
                        <div style="padding: 1.5rem; border-top: 2px solid var(--color-light-gray); display: flex; gap: 1rem;">
                            <button onclick="closePDFReportModal()" style="flex: 1; padding: 0.8rem; background: #ddd; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.3s;" onmouseover="this.style.background='#ccc'" onmouseout="this.style.background='#ddd'">Cancelar</button>
                            <button onclick="generatePDFReport()" style="flex: 2; padding: 0.8rem; background: var(--gradient-primary); border: none; border-radius: 8px; font-weight: 700; cursor: pointer; color: var(--color-secondary); transition: all 0.3s;">üìÑ Generar PDF</button>
                        </div>
                    </div>
                </div>
                <!-- VIDEO PROGRESS BAR -->
                <div id="videoProgressBar" style="display: none; position: fixed; bottom: 100px; left: 50%; transform: translateX(-50%); background: rgba(255,255,255,0.98); padding: 1.5rem; border-radius: 12px; box-shadow: 0 8px 32px rgba(0,0,0,0.3); z-index: 10000; min-width: 350px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <span style="font-weight: 700; color: var(--color-secondary); font-size: 1rem;">üé• Grabando Video</span>
                        <span id="videoTimeRemaining" style="font-weight: 700; color: #E63946; font-size: 1rem;">20s</span>
                    </div>
                    <div style="width: 100%; height: 8px; background: var(--color-light-gray); border-radius: 10px; overflow: hidden; margin-bottom: 1rem;">
                        <div id="videoProgressFill" style="width: 0%; height: 100%; background: linear-gradient(90deg, var(--color-primary), var(--color-accent)); transition: width 0.3s ease;"></div>
                    </div>
                    <button onclick="stopVideoRecording()" style="width: 100%; padding: 0.6rem; background: #E63946; color: white; border: none; border-radius: 8px; font-weight: 700; cursor: pointer; transition: all 0.3s ease;" onmouseover="this.style.background='#C1121F'" onmouseout="this.style.background='#E63946'">‚èπÔ∏è Detener Grabaci√≥n</button>
                </div>        
    </section>

    <!-- BACK TO DETAIL BUTTON -->
    <section style="padding: 2rem 0; background: var(--color-light-gray);">
        <div class="container" style="text-align: center;">
            <a href="#" onclick="backToDetail(); return false;" class="btn btn-secondary" style="display: inline-flex; align-items: center; gap: 0.5rem;">
                ‚Üê Ver Detalle del Modelo
            </a>
        </div>
    </section>

    <!-- FOOTER -->
    <footer>
        <div class="footer-content">
            <p>&copy; 2026 MonteVer3D - Universidad Austral de Chile, Puerto Montt</p>
            <p style="margin-top: 1rem; font-size: 0.9rem;">
                Proyecto de Conservaci√≥n Digital del Patrimonio | Desarrollado por TecMedHUB |
                <a href="mailto:fernanda.lopez@uach.cl" style="color: var(--color-primary);">fernanda.lopez@uach.cl</a>
            </p>
        </div>
    </footer>

    <!-- SCRIPTS (ADVANCED TOOLS) -->
    <script src="js/nav.js"></script>
    <script src="js/material-modes.js"></script>
    <script src="js/loader-utils.js"></script>
    <script src="js/viewer-controls.js"></script>
    <script src="js/model-viewer-lab.js"></script>
    <script src="js/measurement-tools.js"></script>
    <script src="js/export-tools.js"></script>
    
    <script>
    function backToDetail() {
        const urlParams = new URLSearchParams(window.location.search);
        const modelId = urlParams.get('id');
        window.location.href = 'model.html?id=' + modelId;
    }
    </script>
</body>
</html>
