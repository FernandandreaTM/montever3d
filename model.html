<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="pageTitle">Modelo - MonteVer3D</title>
    <meta name="description" content="Detalle del modelo 3D arqueol√≥gico">
    <link rel="icon" type="image/png" href="images/favicon.png">
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/model.css">
    
    <!-- Three.js r84 + Loaders -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/84/three.min.js"></script>
    <script src="https://cdn.rawgit.com/mrdoob/three.js/r84/examples/js/loaders/STLLoader.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/mrdoob/three.js@r84/examples/js/loaders/OBJLoader.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/mrdoob/three.js@r84/examples/js/loaders/MTLLoader.js"></script>
    <script src="https://cdn.rawgit.com/mrdoob/three.js/r84/examples/js/controls/OrbitControls.js"></script>
</head>
<body>
    <!-- HEADER & NAVIGATION -->
    <header>
        <nav>
            <div class="logo-container">
                <img src="images/logo/logo-monteverde.png" alt="MonteVer3D Logo" class="logo-monteverde">
                <img src="images/logo/logo-uach.png" alt="Universidad Austral de Chile" class="logo-uach">
            </div>
            <ul class="nav-links" id="navLinks">
                <li><a href="index.html">INICIO</a></li>
                <li><a href="catalog.html">CAT√ÅLOGO</a></li>
                <li><a href="casos.html">CASOS DE USO</a></li>
                <li><a href="index.html#como-funciona">C√ìMO FUNCIONA</a></li>
                <li><a href="about.html">ACERCA DE</a></li>
                <li><a href="index.html#cta-section">CONTRIBUIR</a></li>
                <li><a href="index.html#cta-section">CONTACTO</a></li>
            </ul>
            
            <button class="menu-toggle" id="menuToggle" aria-label="Toggle menu">
                <span></span>
                <span></span>
                <span></span>
            </button>
        </nav>
    </header>
    
    <!-- Admin Link -->
    <a href="admin/index.html" class="admin-link" title="Panel de Administraci√≥n">üîí</a>

    <!-- BREADCRUMB -->
    <section class="breadcrumb-section">
        <div class="container">
            <div class="breadcrumb">
                <a href="index.html">Inicio</a>
                <span>‚Ä∫</span>
                <a href="catalog.html">Cat√°logo</a>
                <span>‚Ä∫</span>
                <span id="breadcrumbCategory">Categor√≠a</span>
            </div>
        </div>
    </section>

    <!-- 3D VIEWER HERO SECTION -->
    <section class="viewer-hero-section" id="viewerSection" style="display: none;">
        <div class="container">
            <div class="viewer-hero-header">
                <div>
                    <h1 id="modelTitle">Cargando modelo...</h1>
                    <div id="modelBadges" class="model-badges-container"></div>
                    <p id="modelCategory" class="model-category-tag"></p>
                </div>
            </div>
            
            <div class="viewer-hero-container">
                <!-- Enhanced Floating Controls - Max 2 columns -->
                <div class="viewer-floating-controls">
                    <!-- Toast Notification -->
                    <div id="viewerToast" class="viewer-toast"></div>
                    <!-- Camera & View Group (2x2 grid) -->
                    <div class="control-group control-group-grid">
                        <button class="viewer-control-btn" onclick="cycleCameraView()" title="Cambiar vista">
                            üé•
                        </button>
                        <button class="viewer-control-btn" id="cameraRotateBtn" onclick="toggleCameraRotation()" title="Auto-rotaci√≥n c√°mara">
                            üé¨
                        </button>
                        <button class="viewer-control-btn" id="screenshotBtn" onclick="takeScreenshot()" title="Captura de pantalla">
                            üì∑
                        </button>
                        <button class="viewer-control-btn" onclick="toggleViewerFullscreen()" title="Pantalla completa">
                            üñ•Ô∏è
                        </button>
                    </div>
                    
                    <!-- Material & Background Group (2x2 grid) -->
                    <div class="control-group control-group-grid">
                        <button class="viewer-control-btn" onclick="toggleMaterialMode()" title="Cambiar modo de material">
                            üé®
                        </button>
                        <input type="color" id="bgColorPicker" value="#2F5233" onchange="setSceneColor(this.value)" 
                            class="viewer-control-btn color-picker-btn" title="Color de fondo">
                        <button class="viewer-control-btn" id="groundBtn" onclick="toggleGround()" title="Toggle Bandeja" 
                                style="background: rgba(245, 200, 66, 0.9);">
                            üèûÔ∏è
                        </button>
                        <button class="viewer-control-btn" id="gridBtn" onclick="toggleGrid()" title="Toggle Grid"
                                style="background: rgba(245, 200, 66, 0.9);">
                            üìê
                        </button>
                    </div>
                    
                    <!-- Advanced Tools (2 columns) -->
                    <div class="control-group control-group-horizontal">
                        <button class="viewer-control-btn" onclick="toggleRepositionPanel()" title="Rotaci√≥n del Modelo">
                            üåÄ
                        </button>
                        <button class="viewer-control-btn" onclick="toggleMeasurementPanel()" title="Herramientas de Medici√≥n">
                            üìè
                        </button>
                    </div>
                    
                    <!-- Reset -->
                    <button class="viewer-reset-btn" onclick="resetAndScroll()" title="Resetear vista">
                        üîÑ
                    </button>
                </div>
                
                <div class="rotation-advanced-panel" id="repositionPanel">
                    <div class="rotation-panel-header">
                        <span>üåÄ Rotaci√≥n del Modelo</span>
                        <button onclick="toggleRepositionPanel()" class="panel-close-btn">√ó</button>
                    </div>
                    
                    <div class="rotation-panel-content">
                        <div class="rotation-option">
                            <label>Girar Modelo:</label>
                            <button id="modelRotateToggle" class="rotation-mode-btn" onclick="toggleModelRotation()"
                                    style="width: 100%;">
                                üåÄ Activar Rotaci√≥n
                            </button>
                        </div>
                        
                        <div class="rotation-option" style="opacity: 0.5;">
                            <label>Velocidad: <span id="speedValue">0.01</span></label>
                            <input type="range" id="speedSlider" min="0.005" max="0.05" step="0.005" value="0.01" 
                                oninput="updateRotationSpeed(this.value)" class="rotation-slider">
                        </div>
                        
                        <div class="rotation-option" style="opacity: 0.5;">
                            <label>Eje:</label>
                            <select id="axisSelect" onchange="setRotationAxis(this.value)" class="rotation-select">
                                <option value="x">X (Horizontal)</option>
                                <option value="y" selected>Y (Vertical)</option>
                                <option value="z">Z (Profundidad)</option>
                            </select>
                        </div>
                        
                        <div class="rotation-option">
                            <label>üéØ Rotaci√≥n Manual:</label>
                            <div class="manual-rotation-controls">
                                <div class="rotation-axis-control">
                                    <span class="axis-label">X:</span>
                                    <input type="range" id="rotation-x-slider" min="0" max="360" value="0" 
                                        oninput="updateRotationInput('x', this.value)" class="rotation-slider-small">
                                    <input type="number" id="rotation-x-value" min="0" max="360" value="0" 
                                        oninput="setManualRotation('x', this.value); document.getElementById('rotation-x-slider').value = this.value"
                                        class="rotation-number-input">
                                </div>
                                <div class="rotation-axis-control">
                                    <span class="axis-label">Y:</span>
                                    <input type="range" id="rotation-y-slider" min="0" max="360" value="0" 
                                        oninput="updateRotationInput('y', this.value)" class="rotation-slider-small">
                                    <input type="number" id="rotation-y-value" min="0" max="360" value="0" 
                                        oninput="setManualRotation('y', this.value); document.getElementById('rotation-y-slider').value = this.value"
                                        class="rotation-number-input">
                                </div>
                                <div class="rotation-axis-control">
                                    <span class="axis-label">Z:</span>
                                    <input type="range" id="rotation-z-slider" min="0" max="360" value="0" 
                                        oninput="updateRotationInput('z', this.value)" class="rotation-slider-small">
                                    <input type="number" id="rotation-z-value" min="0" max="360" value="0" 
                                        oninput="setManualRotation('z', this.value); document.getElementById('rotation-z-slider').value = this.value"
                                        class="rotation-number-input">
                                </div>
                                <button onclick="resetManualRotation()" class="rotation-axis-reset-btn">‚Ü∫ Reset Rotaci√≥n</button>
                            </div>
                        </div>
                        
                        <button onclick="resetRotationSettings()" class="rotation-reset-btn">üîÑ Restaurar Todo</button>
                    </div>
                </div> 
                <!-- MEASUREMENT TOOLS PANEL -->
                <div class="rotation-advanced-panel" id="measurementPanel">
                    <div class="rotation-panel-header">
                        <span>üìè Herramientas de Medici√≥n</span>
                        <button onclick="toggleMeasurementPanel()" class="panel-close-btn">√ó</button>
                    </div>
                    
                    <div class="rotation-panel-content">
                        <div class="rotation-option">
                            <label>Unidades:</label>
                            <select id="unitSelect" onchange="changeMeasurementUnit(this.value)" class="rotation-select">
                                <option value="mm" selected>Mil√≠metros (mm)</option>
                                <option value="cm">Cent√≠metros (cm)</option>
                                <option value="m">Metros (m)</option>
                            </select>
                        </div>
                        
                        <!-- Dimension Display -->
                        <div class="rotation-option" style="border-bottom: 2px solid var(--color-light-gray); padding-bottom: 0.75rem; margin-bottom: 0.75rem;">
                            <button id="dimensionsToggle" onclick="toggleDimensions()" class="rotation-mode-btn" style="width: 100%;">
                                üì¶ Mostrar Dimensiones
                            </button>
                        </div>
                        
                        <!-- Distance Measurement Tool -->
                        <div class="rotation-option">
                            <label style="font-weight: 600;">üìç Medir entre Puntos</label>
                            <button id="distanceMeasureToggle" onclick="toggleDistanceMeasurement()" class="rotation-mode-btn" style="width: 100%; margin-top: 0.5rem;">
                                üìç Activar Medici√≥n
                            </button>
                            <button id="clearDistanceBtn" onclick="clearDistanceMeasurement()" class="rotation-axis-reset-btn" style="width: 100%; margin-top: 0.5rem; opacity: 0.5;" disabled>
                                üóëÔ∏è Borrar Medici√≥n
                            </button>
                            <div id="distanceInfo" style="margin-top: 0.5rem; padding: 0.5rem; background: rgba(212, 164, 53, 0.1); border-radius: 5px; font-size: 0.85rem; color: var(--color-secondary); text-align: center; display: none;">
                                Click en el modelo para marcar puntos
                            </div>
                        </div>
                    </div>
                </div>       
                <!-- Three.js canvas -->
                <div id="modelViewer" class="model-viewer-canvas">
                    <div class="viewer-loading">
                        <div class="loader"></div>
                        <p>Cargando modelo 3D...</p>
                    </div>
                </div>
                
                <div class="rotation-hint active" id="rotationHint">
                    <button class="rotation-hint-close" onclick="closeRotationHint()">√ó</button>
                    <span class="rotation-hint-icon">üîÑ</span>
                    <p>Rota tu dispositivo a horizontal para mejor visualizaci√≥n</p>
                </div>
            </div>
        </div>
    </section>

    <!-- MODEL DETAIL CONTENT -->
    <section class="model-detail">
        <div class="container">
            <div class="model-grid">
                <!-- LEFT: Image Gallery + Tags -->
                <div class="gallery-section">
                    <div class="gallery-main">
                        <img id="mainImage" src="" alt="Model preview">
                        <button class="gallery-fullscreen" id="fullscreenBtn" aria-label="Ver en pantalla completa">
                            üîç
                        </button>
                    </div>
                    
                    <div class="gallery-thumbnails" id="galleryThumbnails">
                    </div>

                    <div class="detail-card" style="margin-top: 1rem;">
                        <h3>Etiquetas</h3>
                        <div id="modelTags" class="tags-container">
                        </div>
                    </div>
                </div>

                <!-- RIGHT: Model Details -->
                <div class="details-section">
                    <div class="detail-card">
                        <h3>Descripci√≥n</h3>
                        <p id="modelDescription"></p>
                    </div>

                    <div class="detail-card">
                        <h3>Informaci√≥n del Modelo</h3>
                        <div class="info-grid">
                            <div class="info-item">
                                <span class="info-label">Categor√≠a:</span>
                                <span id="infoCat"></span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Tipo:</span>
                                <span id="infoType"></span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Fuente:</span>
                                <span id="infoSource"></span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">M√©todo:</span>
                                <span id="infoOrigin"></span>
                            </div>
                            <div class="info-item" id="fileInfoContainer" style="display: none;">
                                <span class="info-label">Archivo:</span>
                                <span id="infoFile"></span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Notes Section -->
            <div id="notesSection" class="notes-section" style="display: none;">
                <h2>üìù Notas Adicionales</h2>
                <div id="notesContainer" class="notes-display">
                </div>
            </div>
            
            <!-- Attribution Card -->
            <div class="attribution-card">
                <h3>üìú Atribuci√≥n y Licencia</h3>
                <div class="attribution-content">
                    <div class="attribution-item">
                        <span class="attribution-label">Creador:</span>
                        <span id="attrCreator"></span>
                    </div>
                    <div class="attribution-item">
                        <span class="attribution-label">Licencia:</span>
                        <span id="attrLicense"></span>
                    </div>
                    <div class="attribution-item" id="attrSourceContainer">
                        <span class="attribution-label">Fuente:</span>
                        <span id="attrSourceName"></span>
                    </div>
                    <div class="attribution-item" id="attrModsContainer" style="display: none;">
                        <span class="attribution-label">Modificaciones:</span>
                        <span id="attrModifications"></span>
                    </div>
                </div>
            </div>

            <!-- ACTION BUTTONS -->
            <div class="action-buttons" id="actionButtons">
            </div>
        </div>
    </section>

    <!-- RELATED MODELS -->
    <section class="related-models" id="relatedSection" style="display: none;">
        <div class="container">
            <h2>Modelos Relacionados</h2>
            <div id="relatedModels" class="models-grid">
            </div>
        </div>
    </section>

    <!-- LIGHTBOX -->
    <div id="lightbox" class="lightbox">
        <button class="lightbox-close" id="lightboxClose">‚úï</button>
        <button class="lightbox-prev" id="lightboxPrev">‚Äπ</button>
        <button class="lightbox-next" id="lightboxNext">‚Ä∫</button>
        <img id="lightboxImage" src="" alt="">
    </div>

    <!-- FOOTER -->
    <footer>
        <div class="footer-content">
            <p>&copy; 2026 MonteVer3D - Universidad Austral de Chile, Puerto Montt</p>
            <p style="margin-top: 1rem; font-size: 0.9rem;">
                Proyecto de Conservaci√≥n Digital del Patrimonio | Desarrollado por TecMedHUB
                <a href="mailto:fernanda.lopez@uach.cl" style="color: var(--color-primary);">fernanda.lopez@uach.cl</a>
            </p>
        </div>
    </footer>

    <!-- SCRIPTS -->
    <script src="js/nav.js"></script>
    <!-- 3D Viewer Modules (order matters) -->
    <script src="js/material-modes.js"></script>
    <script src="js/loader-utils.js"></script>
    <script src="js/viewer-controls.js"></script>
    <script src="js/model-viewer.js"></script>
    <script src="js/measurement-tools.js"></script>
</body>
</html>
